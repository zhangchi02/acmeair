inputs:
  appId:
    default: acmeair
    description: 默认应用名称
    label: huaweiair
  booking_image:
    default: >-
      swr.cn-north-1.myhuaweicloud.com/servicestage/huaweiair-booking-service:huaweicloud-2.3.32-01
    description: booking服务镜像地址
    label: huaweiair
  booking_name:
    default: huaweiair-booking
    description: booking服务名称
    label: huaweiair
  customer_image:
    default: >-
      swr.cn-north-1.myhuaweicloud.com/servicestage/huaweiair-customer-service:huaweicloud-2.3.32-01
    description: customer服务镜像地址
    label: huaweiair
  customer_name:
    default: huaweiair-customer
    description: customer服务名称
    label: huaweiair
  mongo_image:
    default: 'swr.cn-north-1.myhuaweicloud.com/servicestage/mongo:1.0.0'
    description: mongodb镜像地址
    label: mongodb
  mongo_name:
    default: mongodb
    description: mongodb服务名称
    label: mongodb
  mongo_port:
    default: 32717
    description: mongodb对外暴露访问端口
    label: mongodb
    type: integer
  website_image:
    default: >-
      swr.cn-north-1.myhuaweicloud.com/servicestage/huaweiair-website:huaweicloud-2.3.32-01
    description: wwebsite服务镜像地址
    label: huaweiair
  website_name:
    default: huaweiair-website
    description: website服务名称
    label: huaweiair
  website_port:
    default: 30100
    description: website服务对外暴露访问端口
    label: huaweiair
    type: integer
metadata:
  Designer:
    4cc6d116-ee2c-44ab-b88a-2c7bc7022766:
      size:
        width: 60
        height: 60
      position:
        x: 230
        y: 110
      z: 1
      dependson:
        - 6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7
        - f4b5614f-4ee5-44a6-a1bb-03d76f981892
    6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7:
      size:
        width: 60
        height: 60
      position:
        x: 110
        y: 30
      z: 1
      dependson:
        - f941b656-a0a1-41b4-a6de-3533427acbc7
    7dfbf088-08f3-4c84-b9af-0e276cbee3b9:
      size:
        width: 60
        height: 60
      position:
        x: 360
        y: 160
      z: 1
      policy:
        - f941b656-a0a1-41b4-a6de-3533427acbc7
        - 4cc6d116-ee2c-44ab-b88a-2c7bc7022766
        - e3b32c8b-3970-47f9-b298-991fda2a1499
        - eb7f2925-4a36-4612-9cab-379154e7f0b9
    e3b32c8b-3970-47f9-b298-991fda2a1499:
      size:
        width: 60
        height: 60
      position:
        x: 230
        y: 210
      z: 1
      dependson:
        - f4b5614f-4ee5-44a6-a1bb-03d76f981892
        - 6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7
    e5d7b724-a065-4684-be1c-49994270db82:
      size:
        width: 60
        height: 60
      position:
        x: 110
        y: 290
      z: 1
      dependson:
        - eb7f2925-4a36-4612-9cab-379154e7f0b9
    eb7f2925-4a36-4612-9cab-379154e7f0b9:
      size:
        width: 60
        height: 60
      position:
        x: 230
        y: 290
      z: 1
      dependson:
        - f4b5614f-4ee5-44a6-a1bb-03d76f981892
    f4b5614f-4ee5-44a6-a1bb-03d76f981892:
      size:
        width: 60
        height: 60
      position:
        x: 110
        y: 110
      z: 1
    f941b656-a0a1-41b4-a6de-3533427acbc7:
      size:
        width: 60
        height: 60
      position:
        x: 230
        y: 30
      z: 1
      dependson:
        - f4b5614f-4ee5-44a6-a1bb-03d76f981892
    e3342c78-9bdc-4231-a4bd-467867409a8c:
      source:
        id: eb7f2925-4a36-4612-9cab-379154e7f0b9
      target:
        id: f4b5614f-4ee5-44a6-a1bb-03d76f981892
      z: 1
    7dc46f36-e212-4da1-87b5-405f2342b8f3:
      source:
        id: e5d7b724-a065-4684-be1c-49994270db82
      target:
        id: eb7f2925-4a36-4612-9cab-379154e7f0b9
      z: 1
    2012a256-c67c-4e05-95d0-da467cd56962:
      source:
        id: f941b656-a0a1-41b4-a6de-3533427acbc7
      target:
        id: f4b5614f-4ee5-44a6-a1bb-03d76f981892
      z: 1
    ed1ce596-d9b5-4693-9172-267c9789cf78:
      source:
        id: 6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7
      target:
        id: f941b656-a0a1-41b4-a6de-3533427acbc7
      z: 1
    b1ec50c5-dc2a-4e36-bc9e-45ea50dc7f4b:
      source:
        id: 4cc6d116-ee2c-44ab-b88a-2c7bc7022766
      target:
        id: f4b5614f-4ee5-44a6-a1bb-03d76f981892
      z: 1
    d927e051-1975-4b31-b707-a9d23bc31069:
      source:
        id: 4cc6d116-ee2c-44ab-b88a-2c7bc7022766
      target:
        id: 6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7
      z: 1
    b473905e-e836-4709-8334-60feeb92e8d1:
      source:
        id: e3b32c8b-3970-47f9-b298-991fda2a1499
      target:
        id: f4b5614f-4ee5-44a6-a1bb-03d76f981892
      z: 1
    3d7dc4b8-1af6-4334-82d5-94b58915349b:
      source:
        id: e3b32c8b-3970-47f9-b298-991fda2a1499
      target:
        id: 6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7
      z: 1
    04c9e6b5-c574-4c2a-8347-34bf95c3ba10:
      source:
        id: 7dfbf088-08f3-4c84-b9af-0e276cbee3b9
      target:
        id: f941b656-a0a1-41b4-a6de-3533427acbc7
      z: 1
    fabe36d2-2779-46d2-9e34-67efd833034a:
      source:
        id: 7dfbf088-08f3-4c84-b9af-0e276cbee3b9
      target:
        id: 4cc6d116-ee2c-44ab-b88a-2c7bc7022766
      z: 1
    71037bef-1d3b-4251-b54a-590c8e6dbbb0:
      source:
        id: 7dfbf088-08f3-4c84-b9af-0e276cbee3b9
      target:
        id: e3b32c8b-3970-47f9-b298-991fda2a1499
      z: 1
    94553094-120d-420b-a486-3a2353c25eb2:
      source:
        id: 7dfbf088-08f3-4c84-b9af-0e276cbee3b9
      target:
        id: eb7f2925-4a36-4612-9cab-379154e7f0b9
      z: 1
  relationships:
    4cc6d116-ee2c-44ab-b88a-2c7bc7022766:
      references:
        dependency:
          - get_reference: huaweiair-config
          - get_reference: mongo-service
    6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7:
      references:
        dependency:
          - get_reference: mongo
    7dfbf088-08f3-4c84-b9af-0e276cbee3b9:
      references:
        targets:
          - mongo
          - customer
          - booking
          - website
    e3b32c8b-3970-47f9-b298-991fda2a1499:
      references:
        dependency:
          - get_reference: huaweiair-config
          - get_reference: mongo-service
    e5d7b724-a065-4684-be1c-49994270db82:
      references:
        dependency:
          - get_reference: website
    eb7f2925-4a36-4612-9cab-379154e7f0b9:
      references:
        dependency:
          - get_reference: huaweiair-config
    f941b656-a0a1-41b4-a6de-3533427acbc7:
      references:
        dependency:
          get_reference: huaweiair-config
node_templates:
  booking:
    metadata:
      Designer:
        id: e3b32c8b-3970-47f9-b298-991fda2a1499
    properties:
      k8sManifest:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          labels:
            app:
              get_input: booking_name
          name:
            get_input: booking_name
        spec:
          replicas: 1
          selector:
            matchLabels:
              app:
                get_input: booking_name
          template:
            metadata:
              labels:
                app:
                  get_input: booking_name
            spec:
              containers:
                - env:
                    - name: JAR_NAME
                      value: acmeair-booking-service
                    - name: JAVA_OPTS
                      valueFrom:
                        configMapKeyRef:
                          key: java_opts
                          name:
                            get_attribute:
                              - huaweiair-config
                              - refName
                    - name: APPLICATION_ID
                      value:
                        get_input: appId
                  image:
                    get_input: booking_image
                  name: booking-container
              imagePullSecrets:
                - name: default-secret
    requirements:
      - dependency:
          node: huaweiair-config
      - dependency:
          node: mongo-service
    type: HuaweiCloud.CCE.Deployment
  customer:
    metadata:
      Designer:
        id: 4cc6d116-ee2c-44ab-b88a-2c7bc7022766
    properties:
      k8sManifest:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          labels:
            app:
              get_input: customer_name
          name:
            get_input: customer_name
        spec:
          replicas: 1
          selector:
            matchLabels:
              app:
                get_input: customer_name
          template:
            metadata:
              labels:
                app:
                  get_input: customer_name
            spec:
              containers:
                - env:
                    - name: JAR_NAME
                      value: acmeair-customer-service
                    - name: JAVA_OPTS
                      valueFrom:
                        configMapKeyRef:
                          key: java_opts
                          name:
                            get_attribute:
                              - huaweiair-config
                              - refName
                    - name: APPLICATION_ID
                      value:
                        get_input: appId
                  image:
                    get_input: customer_image
                  name: customer-container
              imagePullSecrets:
                - name: default-secret
    requirements:
      - dependency:
          node: huaweiair-config
      - dependency:
          node: mongo-service
    type: HuaweiCloud.CCE.Deployment
  huaweiair-config:
    metadata:
      Designer:
        id: f4b5614f-4ee5-44a6-a1bb-03d76f981892
    properties:
      data:
        java_opts:
          concat:
            - '-Dspring.profiles.active=mongodb '
            - '-Dspring.data.mongodb.host=mongodb '
            - '-Dspring.data.mongodb.port='
            - get_input: mongo_port
    type: HuaweiCloud.CCE.ConfigMap
  mongo:
    metadata:
      Designer:
        id: f941b656-a0a1-41b4-a6de-3533427acbc7
    properties:
      k8sManifest:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          labels:
            app:
              get_input: mongo_name
          name:
            get_input: mongo_name
        spec:
          replicas: 1
          selector:
            matchLabels:
              app:
                get_input: mongo_name
          template:
            metadata:
              labels:
                app:
                  get_input: mongo_name
            spec:
              containers:
                - image:
                    get_input: mongo_image
                  name: mongo-container
              imagePullSecrets:
                - name: default-secret
    requirements:
      - dependency:
          node: huaweiair-config
    type: HuaweiCloud.CCE.Deployment
  mongo-service:
    metadata:
      Designer:
        id: 6c6bb9f7-24b5-4a11-87cb-8bfbff9764a7
    properties:
      k8sManifest:
        apiVersion: v1
        kind: Service
        metadata:
          labels:
            app:
              get_input: mongo_name
          name:
            get_input: mongo_name
        spec:
          ports:
            - name: mongodb
              port: 32717
              protocol: TCP
              targetPort: 27017
          selector:
            app:
              get_input: mongo_name
          type: ClusterIP
    requirements:
      - dependency:
          node: mongo
    type: HuaweiCloud.CCE.Service
  website:
    metadata:
      Designer:
        id: eb7f2925-4a36-4612-9cab-379154e7f0b9
    properties:
      k8sManifest:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          labels:
            app:
              get_input: website_name
          name:
            get_input: website_name
        spec:
          replicas: 1
          selector:
            matchLabels:
              app:
                get_input: website_name
          template:
            metadata:
              labels:
                app:
                  get_input: website_name
            spec:
              containers:
                - env:
                    - name: JAR_NAME
                      value: acmeair-webapp
                    - name: JAVA_OPTS
                      value: '-Dspring.profiles.active=sc'
                    - name: APPLICATION_ID
                      value:
                        get_input: appId
                  image:
                    get_input: website_image
                  name: website-container
                  ports:
                    - containerPort: 8080
                      protocol: TCP
              imagePullSecrets:
                - name: default-secret
    requirements:
      - dependency:
          node: huaweiair-config
    type: HuaweiCloud.CCE.Deployment
  website-service:
    metadata:
      Designer:
        id: e5d7b724-a065-4684-be1c-49994270db82
    properties:
      k8sManifest:
        apiVersion: v1
        kind: Service
        metadata:
          labels:
            app:
              get_input: website_name
          name:
            get_input: website_name
        spec:
          ports:
            - name:
                get_input: website_name
              nodePort:
                get_input: website_port
              port: 8080
              protocol: TCP
              targetPort: 8080
          selector:
            app:
              get_input: website_name
          type: NodePort
    requirements:
      - dependency:
          node: website
    type: HuaweiCloud.CCE.Service
outputs: {}
policies:
  huaweiair-apm:
    metadata:
      Designer:
        id: 7dfbf088-08f3-4c84-b9af-0e276cbee3b9
    properties:
      name:
        get_input: HuaweiCloud.StackName
    targets:
      - mongo
      - customer
      - booking
      - website
    type: HuaweiCloud.APM.Pinpoint
tosca_definitions_version: huaweicloud_tosca_version_1_0
